<div>
    <link href="./home.css" rel="stylesheet" />

    <div class="background">
        <div class="container">
            <h1>All Lights</h1>
            <h2>Light used :</h2>

            <div class="container_small" id="container_small">

            </div>
            <div class="button-container" style="text-align: right;">
                <br><button id="small-screen-button">Add Light</button>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {

        $.ajax({
            type: "GET",
            url: "/SmartLightProject/data/light_name.csv",
            dataType: "text",
            success: function (data) {
                processName(data);
            }
        });

        function processName(data) {
            var lines = data.split(/\r\n|\n/);
            for (var i = 1; i < lines.length; i++) {
                var cells = lines[i].split(",");
                var id = cells[0];
                var name = cells[1];
                var status = cells[2].replace(/"/g, "");

                if (name !== "FALSE") {

                    var container_name = $('<div></div>').addClass('name-container');

                    var modelElement = $('<div></div>').addClass('text-name');
                    modelElement.text(name);

                    var sun = $()

                    if (status === "sun") {
                        container_name.append('<img src="/SmartLightProject/images/icon_sun.png" alt="no image" width="10%" height="90%">')
                    }
                    else {
                        container_name.append('<img src="/SmartLightProject/images/icon_moon.png" alt="no image" width="10%" height="90%">')
                    }

                    container_name.append(modelElement);
                    $('<img src="/SmartLightProject/images/icon_adjustment.png" alt="no image" width="10%" height="90%">').appendTo(container_name).click(function () {
                        $('<div>').appendTo('body').addClass('overlay');
                        var $container = $('<div>Adjustment</div>').appendTo('body').attr('id', 'connectable-lights').css({
                            position: 'fixed',
                            top: '50%',
                            left: '50%',
                            transform: 'translate(-50%, -50%)',
                            width: '400px',
                            height: '400px',
                            background: '#fff',
                            border: '1px solid #808080',
                            'border-radius': '5px',
                            'text-align': 'center',
                            'line-height': '50px',
                            'font-size': '24px',
                            'z-index': '1000'
                        });
                        $('<div id="inner-screen"></div>').appendTo($container).css({
                            position: 'absolute',
                            top: '45%',
                            left: '50%',
                            transform: 'translate(-50%, -50%)',
                            width: '90%',
                            height: '65%',
                            background: '#fff',
                            'z-index': '2',    
                            border: '1px solid  #89c4ff',
                            'border-radius': '5px',                        
                            
                        });
                        $('<div id="button-screen"></div>').appendTo($container).css({
                            position: 'fixed',
                            display: 'flex',
                            top: '85%',
                            left: '50%',
                            transform: 'translate(-50%, -50%)',
                            width: '90%',
                            height: '20%',
                            background: 'tarnsparent',
                            'z-index': '2',
                            display: 'flex',
                            'flex-wrap': 'wrap',
                            'justify-content': 'left',
                            'align-items': 'center'
                        });
                        $('<label for="volume">Brightness:</label><br>').appendTo('#inner-screen').css({
                            'font-size': '18px',
                        });
                        $('<img src="/SmartLightProject/images/icon_moon.png" alt="no image" width="5%" height="8%">').appendTo('#inner-screen');
                        $('<input type="range" id="volume" name="volume" min="0" max="100" value="50">').appendTo('#inner-screen');
                        $('<img src="/SmartLightProject/images/icon_sun.png" alt="no image" width="5%" height="8%"><br>').appendTo('#inner-screen');
                        $('<label for="color">Colour:</label><br>').appendTo('#inner-screen').css({
                            'font-size': '18px',
                        });
                        $('<input type="color" value="#4251f5" /><br>').appendTo('#inner-screen');
                        $('<button>Auto Setting</button>').appendTo('#button-screen').addClass('button-auto');
                        var switchArea = $('<div>').addClass('switchArea');
                        switchArea.append('<input type="checkbox" id="switch1">');
                        switchArea.append('<label for="switch1"><span></span></label>');
                        switchArea.append('<div id="swImg"></div>').click(function() {     
                            $("#volume").val(0);
                            $("input[type='color']").val("#000000");
                        });;
                        $('#inner-screen').append(switchArea);


                        $('<img id="close-button" src="/SmartLightProject/images/icon_cancel.png">').appendTo($container).css({
                            position: 'absolute',
                            top: '5px',
                            right: '5px',
                            width: '20px',
                            height: '20px',
                            cursor: 'pointer',
                            'z-index': '2',
                        }).click(function () {
                            $('.overlay').remove();
                            $container.remove();
                        });
                    });
                    $('<img src="/SmartLightProject/images/icon_menu.png" alt="no image" width="10%" height="90%">').appendTo(container_name);

                    $('#container_small').append(container_name);
                }
            }

        }

        $('#small-screen-button').click(function () {
            $('<div>').appendTo('body').addClass('overlay');
            var $container = $('<div>Connectable Lights</div>').appendTo('body').attr('id', 'connectable-lights').css({
                position: 'fixed',
                top: '50%',
                left: '50%',
                transform: 'translate(-50%, -50%)',
                width: '400px',
                height: '400px',
                background: '#fff',
                border: '1px solid #808080',
                'border-radius': '5px',
                'text-align': 'center',
                'line-height': '50px',
                'font-size': '24px',
                'z-index': '1000'
            });
            $('<div id="inner-screen"></div>').appendTo($container).css({
                position: 'absolute',
                top: '55%',
                left: '50%',
                transform: 'translate(-50%, -50%)',
                width: '90%',
                height: '80%',
                background: '#d7d7d7',
                'z-index': '2',
            });
            $('<img id="close-button" src="/SmartLightProject/images/icon_cancel.png">').appendTo($container).css({
                position: 'absolute',
                top: '5px',
                right: '5px',
                width: '20px',
                height: '20px',
                cursor: 'pointer',
                'z-index': '2',
            }).click(function () {
                $('.overlay').remove();
                $container.remove();
            });

            $.ajax({
                type: "GET",
                url: "/SmartLightProject/data/connect_data.csv",
                dataType: "text",
                success: function (data) {
                    processData(data);
                }
            });

            function processData(data) {
                var lines = data.split(/\r\n|\n/);
                for (var i = 1; i < lines.length; i++) {
                    var cells = lines[i].split(",");
                    var id = cells[0];
                    var connect_status = cells[1];
                    var model_name = cells[2].replace(/"/g, "");

                    if (connect_status === "FALSE") {

                        var container_model = $('<div></div>').addClass('model-container');

                        var modelElement = $('<div></div>').addClass('text-modelname');
                        if (model_name.length > 40) {
                            model_name = model_name.slice(0, 40) + '...';
                        }
                        modelElement.text(model_name);
                        container_model.append(modelElement);

                        var button_addLight = $('<button>"Connect"</button>').addClass('button-addLight');
                        button_addLight.text('Connect');
                        button_addLight.data('id', id);
                        button_addLight.on('click', function () {
                            var id = $(this).data('id');
                            $(this).text('Connected');
                            $(this).off('click');
                        });

                        container_model.append(button_addLight);
                        $('#inner-screen').append(container_model);
                    }
                }
            }



        });

    });
</script>