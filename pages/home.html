<div>
    <link href="./home.css" rel="stylesheet" />

    <div class="background">
        <div class="container">
            <h1>All Lights</h1>
            <h2>Light used :</h2>

            <div class="container_small">

            </div>
            <div class="button-container" style="text-align: right;">
                <br><button id="small-screen-button">Add Light</button>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('#small-screen-button').click(function () {
            $('<div>').appendTo('body').addClass('overlay');
            var $container = $('<div>Connectable Lights</div>').appendTo('body').attr('id', 'connectable-lights').css({
                position: 'fixed',
                top: '50%',
                left: '50%',
                transform: 'translate(-50%, -50%)',
                width: '400px',
                height: '400px',
                background: '#fff',
                border: '1px solid #808080',
                'border-radius': '5px',
                'text-align': 'center',
                'line-height': '50px',
                'font-size': '24px',
                'z-index': '1000'
            });
            $('<div id="inner-screen"></div>').appendTo($container).css({
                position: 'absolute',
                top: '55%',
                left: '50%',
                transform: 'translate(-50%, -50%)',
                width: '90%',
                height: '80%',
                background: '#d7d7d7',               
                'z-index': '2',
            });
            $('<img id="close-button" src="/images/icon_cancel.png">').appendTo($container).css({
                position: 'absolute',
                top: '5px',
                right: '5px',
                width: '20px',
                height: '20px',
                cursor: 'pointer',
                'z-index': '2',
            }).click(function () {
                $('.overlay').remove();
                $container.remove();
            });

            $.ajax({
                type: "GET",
                url: "/data/connect_data.csv",
                dataType: "text",
                success: function (data) {
                    processData(data);
                }
            });

            function processData(data) {
                var lines = data.split(/\r\n|\n/);
                for (var i = 1; i < lines.length; i++) {
                    var cells = lines[i].split(",");
                    var id = cells[0];
                    var connect_status = cells[1];
                    var model_name = cells[2].replace(/"/g, "");

                    if (connect_status === "FALSE") {

                        var container_model = $('<div></div>').addClass('model-container');

                        var modelElement = $('<div></div>').addClass('text-modelname');
                        if (model_name.length > 40) {
                            model_name = model_name.slice(0, 40) + '...';
                        }
                        modelElement.text(model_name);
                        container_model.append(modelElement);

                        var button_addLight = $('<button>"Connect"</button>').addClass('button-addLight');
                        button_addLight.text('Connect');
                        button_addLight.data('id', id);
                        button_addLight.on('click', function () {
                            var id = $(this).data('id');
                            $(this).text('Connected');
                            $(this).off('click');
                            connect_status = "TRUE";
                            updateData(id, connect_status);
                        });

                        container_model.append(button_addLight);
                        $('#inner-screen').append(container_model);
                    }                
                   
                }
            }


        });
    });
</script>